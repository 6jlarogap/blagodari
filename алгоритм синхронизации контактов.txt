СТРУКТУРА КОНТАКТА:
- идентификатор в нашей БД (далее просто БД)
- идентификатор во внутреннем репозитории (адресной книге)
- имя
- фото
- список ключей

АЛГОРИТМ СИНХРОНИЗАЦИИ КОНТАКТОВ
- считать все контакты из адресной книги
- считать все контакты из БД
- создать три списка контактов (данные списки не должны пересекаться, то есть один контакт не может находится в двух списках):
	- контакты для добавления в БД - это контакты, у которых в адресной книге не было найдено нашего идентификатора.
	- контакты для обновления в БД - это контакты, у которых был найден наш идентификатор, но при сравнении с соответствующим контактом из нашей БД было выявлено одно из следующих изменений:
		- изменился идентификатор в адресной книге;
		- изменилось имя;
		- изменилось фото;
		- изменилось количество ключей, либо один или более ключей не совпадают.
	- контакты для удаления из БД - это контакты, которые есть в нашей БД, но уже отсутствуют в адресной книге.

- пройти по всем контактам из адресной книги:
	- если у контакта нет нашего идентификатора, то добавить его в список для добавления в БД
	- если у контакта есть наш идентификатор
		- найти соответствующий контакт в списке контактов из БД
		- если контакты не равны
			- добавить контакт в список для обновления
		- удалить контакт из списка контактов из БД
		
- все контакты, оставшиеся в списке контактов из БД, перенести в список для удаления из БД (они не были найдены в адресной книге, поэтому их надо удалить)

- выполнить в одной транзакции:
	- удалить необходимые контакты из БД, для этого:
		- деактуализировать связи между благодарностями и ключами контактов (???)
		- разорвать связь между благодарностями и контактами
		- деактуализировать связи пользователя с ключами
		- удалить связи пользователя с контактами
		- удалить связи контактов с ключами
		- удалить контакты
		
	- вставить необходимые контакты в БД, для этого:
		- вставить контакты
		- вставить ключи контактов
		- связать контакты с их ключами
		- связать пользователя с контактами
		- связать пользователя с ключами
		(- если некоторые ключи новых контактов уже имелись в БД и имеют привязанные к ним благодарности, что делать???)
		
	- обновить необходимы контакты в БД, для этого:
		- обновить контакты
		- вставить новые ключи контактов
		- отвязать контакты от старых ключей
		- привязать контакты к новым ключам
		- отвязать пользователя от старых ключей
		- привязать пользователя к новым ключам
		- у благодарностей, привязанных к контактам, деактуализировать связи со старыми ключами (???)
		- благодарности, привязанные к контактам, привязать к новым ключам либо актуализировать связи, если они ранее уже были привязаны к этим ключам (???)
		
	- пометить "неопределенные" ключи, то есть ключи, привязанные более чем к одному контакту
	- благодарности привязанные к неопределенным ключам, отвязать от контактов
	- все связи благодарностей с неопределенными ключами сделать неактуальными (разрым между благодарностями и контактами никак не отразится на сервере, а деактуализация связи благодарности с ключем, синхронизируется с сервером и повлияет на статистику по данному ключу)
	- пересчитать количество благодарностей у контактов

- для контактов из списка для добавления в БД, записать в адресную книгу наши идентификаторы контактов, которые были проставлены после их вставки в БД.
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	